---

title: Machine Learning


keywords: fastai
sidebar: home_sidebar

summary: "Apply simple machine learning algorithms to a measures table"
description: "Apply simple machine learning algorithms to a measures table"
nb_path: "24_machine_learning.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 24_machine_learning.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>INFO:tensorflow:Enabling eager execution
INFO:tensorflow:Enabling v2 tensorshape
INFO:tensorflow:Enabling resource variables
INFO:tensorflow:Enabling tensor equality
INFO:tensorflow:Enabling control flow v2
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Overview">Overview<a class="anchor-link" href="#Overview"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The gamba library contains several wrapper methods for commonly applied machine learning methods. Whilst it would be impossible to cover every machine learning method used in existing literature, the gamba library aims to provide a number of examples so that if you have a particular method in mind, some variant or similar implementation is available for you to extend.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Methods">Methods<a class="anchor-link" href="#Methods"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Clustering">Clustering<a class="anchor-link" href="#Clustering"> </a></h3><p>Clustering techniques have been popular in early literature, but continue to be applied across a number of problems. The gamba library contains wrapper methods around the scikit-learn library, which has implementations of a number of clustering algorithms.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="k_means" class="doc_header"><code>k_means</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L13" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>k_means</code>(<strong><code>measures_table</code></strong>, <strong><code>clusters</code></strong>=<em><code>4</code></em>, <strong><code>data_only</code></strong>=<em><code>False</code></em>, <strong><code>plot</code></strong>=<em><code>False</code></em>, <strong><code>loud</code></strong>=<em><code>False</code></em>)</p>
</blockquote>
<p>Applies the k-means clustering algorithm to a measures table. The resulting clustering is then reported in terms of its inertia (sum of squared distances of samples to their closest cluster center) and its silhouette score (how distinct clusters are within the sample [see the skikit learn docs for details]). The measures passed as the first parameter can be returned with an added column reporting the cluster each player belongs to using the data_only parameter.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="k_means_range" class="doc_header"><code>k_means_range</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L67" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>k_means_range</code>(<strong><code>measures_table</code></strong>, <strong><code>min_clusters</code></strong>=<em><code>2</code></em>, <strong><code>max_clusters</code></strong>=<em><code>13</code></em>)</p>
</blockquote>
<p>Computes the k_means calculation above across a range of cluster counts, returning their goodness of fit measures (inertia and silhouette).</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="k_means_ensemble" class="doc_header"><code>k_means_ensemble</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L83" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>k_means_ensemble</code>(<strong><code>measures_table</code></strong>, <strong><code>ensemble_size</code></strong>=<em><code>100</code></em>, <strong><code>min_clusters</code></strong>=<em><code>2</code></em>, <strong><code>max_clusters</code></strong>=<em><code>13</code></em>)</p>
</blockquote>
<p>Computes the k_means clustering algorithm across a range of cluster counts, a number of times. This is useful for determining clusters in a more robust way but can be slow on large data sets.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="agglomerative_cluster" class="doc_header"><code>agglomerative_cluster</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L114" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>agglomerative_cluster</code>(<strong><code>measures_table</code></strong>, <strong><code>distance_threshold</code></strong>=<em><code>0</code></em>, <strong><code>n_clusters</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Performs sklearn's agglomerative clustering algorithm on a dataframe of behavioural measures. See their documentation for details. Note: Either the distance threshold or the n_cluster parameter must be None.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="describe_clusters" class="doc_header"><code>describe_clusters</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L128" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>describe_clusters</code>(<strong><code>clustered_measures_table</code></strong>, <strong><code>cluster_col</code></strong>=<em><code>'cluster'</code></em>)</p>
</blockquote>
<p>Describes cluster centroids (mean values of each measure) for each cluster in a clustered measures table.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Neural-Networks">Neural Networks<a class="anchor-link" href="#Neural-Networks"> </a></h3><p>Neural networks are a powerful way to learn high dimensional patterns in transaction data sets. The gamba library contains limited neural network capabilities, but provide fully annotated methods so you can copy them into your own workflows and extend them as needed.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="neural_network_classification" class="doc_header"><code>neural_network_classification</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L152" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>neural_network_classification</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>A basic example of a classification network using a single sigmoid-activated output node. The output is the probability of the player belonging to the value of the label. As with the <code>neural_network_regression</code> this network closely follows examples in <a href="http://faculty.neu.edu.cn/yury/AAI/Textbook/Deep%20Learning%20with%20Python.pdf">Deep Learning with Python</a> which is a great resource for extending this example.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="neural_network_regression" class="doc_header"><code>neural_network_regression</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L185" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>neural_network_regression</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>A very simple neural network for regression using two hidden layers and one output node with a linear activation function. This method is very similar to the example in <a href="http://faculty.neu.edu.cn/yury/AAI/Textbook/Deep%20Learning%20with%20Python.pdf">Deep Learning with Python</a>, and can be used as a template for more complex network topologies.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Logistic-Regression">Logistic Regression<a class="anchor-link" href="#Logistic-Regression"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Logistic regression techniques can map simple relationships between variables, but typically become untenable in more complex applications. As with the clustering techniques, the gamba library contains wrappers around the sklearn library's logistic regression functions, offering simple methods to run analyses without having to interact with the sklearn library directly (although you should for advanced techniques!).</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="logistic_regression" class="doc_header"><code>logistic_regression</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L224" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>logistic_regression</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>Performs a logistic regression using the <a href="https://www.statsmodels.org/stable/index.html">statsmodels library</a>, returning the predicted labels rounded to the nearest integer. Note: this method is currently hard-coded to only function on Philander 2014's data set. Abstracted logistic regression function coming soon.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="lasso_logistic_regression" class="doc_header"><code>lasso_logistic_regression</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L245" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>lasso_logistic_regression</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>Performs a 'lasso' (optimizes a least-square problem with L1 penalty) logistic regression using <a href="https://scikit-learn.org/stable/modules/classes.html#module-sklearn.linear_model">sklearn's linear_model</a>. This <a href="https://stackoverflow.com/questions/41639557/how-to-perform-logistic-lasso-in-python&gt;">stackoverflow post</a> contains a useful discussion on this type of function-estimation regression pair.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Support-Vector-Machines">Support Vector Machines<a class="anchor-link" href="#Support-Vector-Machines"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>SVM's are another type of machine learning algorithm but have seen limited use in existing work, but are included as templates to see how they could be used as part of an analysis using the gamba library. The three SVM methods implemented include those used in Philander's 2014 study.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="svm_eps_regression" class="doc_header"><code>svm_eps_regression</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L265" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>svm_eps_regression</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>Creates and trains a support vector machine for epsilon-support vector regression using the sklearn library's implementation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="svm_c_classification" class="doc_header"><code>svm_c_classification</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L289" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>svm_c_classification</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>Creates and trains a support vector machine for classification using the sklearn library's implementation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="svm_one_classification" class="doc_header"><code>svm_one_classification</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L309" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>svm_one_classification</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>Creates and trains a support vector machine for one-class classification using the sklearn library's implementation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Random-Forests">Random Forests<a class="anchor-link" href="#Random-Forests"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Random forests are collections of decision trees which are applied en-mass to classification and regression problems. The gamba library implements both techniques in a very basic form, which follow a similar structure to other machine learning methods in the library. As with many other methods on this page, the gamba library simply contains wrappers for the scikit-learn library, which should be used directly for more advanced analyses!</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rf_regression" class="doc_header"><code>rf_regression</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L335" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rf_regression</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>Creates and fits a random forest regressor using <a href="https://scikit-learn.org/stable/modules/ensemble.html#forest">sklearn's ensemble module</a>, returning the predicted labels rounded to the nearest integer.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="rf_classification" class="doc_header"><code>rf_classification</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L359" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>rf_classification</code>(<strong><code>measures_table</code></strong>, <strong><code>label</code></strong>, <strong><code>train_test_split</code></strong>=<em><code>0.7</code></em>)</p>
</blockquote>
<p>Creates a random forest for classification also using the sklearn library's implementation.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Performance">Performance<a class="anchor-link" href="#Performance"> </a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Performance measures of many machine learning methods can be derived from the values they predict and the actual values of a test dataset. The <code>compute_performance</code> function below is useful for quick estimates of performance, but you should refer to the measures appropriate to the specific method you're implementing for advanced analyses.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="compute_performance" class="doc_header"><code>compute_performance</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L380" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>compute_performance</code>(<strong><code>method_name</code></strong>, <strong><code>actual</code></strong>, <strong><code>predicted</code></strong>)</p>
</blockquote>
<p>Computes performance metrics including sensitivity, specificity, accuracy, confusion matrix values, odds ratio, and area under curve, for a given classification/regression using its actual and predicted values.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Plotting">Plotting<a class="anchor-link" href="#Plotting"> </a></h2><p>Some machine learning outputs favour plotting over raw tabular presentation. An example of this is a hierarchical clustering dendrogram, which is much more intuitive than a cluster membership report. The gamba library contains several methods for plotting the outputs of machine learning models;</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">scipy.cluster.hierarchy</span> <span class="k">as</span> <span class="nn">sch</span>
<span class="kn">import</span> <span class="nn">scipy.ndimage.filters</span> <span class="k">as</span> <span class="nn">snf</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_cluster_sizes" class="doc_header"><code>plot_cluster_sizes</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L417" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_cluster_sizes</code>(<strong><code>model</code></strong>)</p>
</blockquote>
<p>Create a bar chart using a previously computed clustering model. Each bar represents a single cluster, with the height of the bars representing the number of members (players) in each cluster.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="plot_agglomeration_dendrogram" class="doc_header"><code>plot_agglomeration_dendrogram</code><a href="https://github.com/gamba-dev/gamba/tree/main/gamba/machine_learning.py#L436" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>plot_agglomeration_dendrogram</code>(<strong><code>model</code></strong>, <strong><code>dt_cutoff</code></strong>=<em><code>None</code></em>, <strong>**<code>kwargs</code></strong>)</p>
</blockquote>
<p>Create a dendrogram visualising a heirarchical clustering method (agglomerative clustering). A horisontal line can be added using the dt_cutoff parameter to visualise the number of clusters at a given distance threshold.</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

