---

title: Upcoming Features


keywords: fastai
sidebar: home_sidebar

summary: "This page is updated in real time"
description: "This page is updated in real time"
nb_path: "01_upcoming.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 01_upcoming.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This is a feature testing notebook which contains code before it is tested and added to the library's other notebooks. This is a real-time look at what's under development - this page changes with every commit to the github repo.</p>

</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># the measures module currently contains 10 or so unique measures</span>
<span class="c1"># my WIP paper identifies around 40 measures used in published studies, time to get coding...</span>

<span class="c1"># measures from paper</span>
<span class="p">[</span><span class="s1">&#39;Total Amount Wagered&#39;</span><span class="p">,</span> <span class="s1">&#39;Net Loss&#39;</span><span class="p">,</span> <span class="s1">&#39;Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Bets Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency&#39;</span><span class="p">,</span> <span class="s1">&#39;Number Of Bets&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Bet Size&#39;</span><span class="p">,</span> <span class="s1">&#39;Percent Loss&#39;</span><span class="p">,</span> <span class="s1">&#39;Frequency Percent&#39;</span><span class="p">,</span> <span class="s1">&#39;Standard Deviation Of Bet Sizes&#39;</span><span class="p">,</span> <span class="s1">&#39;Daily Total Amount Wagered Trajectory&#39;</span><span class="p">,</span> <span class="s1">&#39;Theoretical Loss&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Number Of Sessions&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Playing Time&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Amount Paid&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Sessions Per Day In Duration&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Playing Time Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Amount Won&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Rake Paid Per Hour&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Simultaneous Tables&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Session Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Max 24H Deposit&#39;</span><span class="p">,</span> <span class="s1">&#39;Max 30D Deposit&#39;</span><span class="p">,</span> <span class="s1">&#39;Median Odds Per Bet&#39;</span><span class="p">,</span> <span class="s1">&#39;Median Stake Per Bet&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Amount Wagered Per Session&#39;</span><span class="p">,</span> <span class="s1">&#39;Median Bets Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Median Loss Per Bet&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Playing Volume Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Max Bet Value&#39;</span><span class="p">,</span> <span class="s1">&#39;Min Bet Value&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Sessions Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Rake Paid Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Standard Deviation Of Bets Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Weekly Number Of Bets Trajectory&#39;</span><span class="p">,</span> <span class="s1">&#39;Weekly Active Days Trajectory&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Game Types Per Day&#39;</span><span class="p">,</span> <span class="s1">&#39;Sawtooth Occurances&#39;</span><span class="p">,</span> <span class="s1">&#39;Number Of Gambling Activities Played&#39;</span><span class="p">,</span> <span class="s1">&#39;Weekend Total Amount Wagered Ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;Weekend Number Of Bets Ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;Positive Total Amount Won&#39;</span><span class="p">,</span> <span class="s1">&#39;Positive Monies Wagered&#39;</span><span class="p">,</span> <span class="s1">&#39;Number Of Gambling Services Used&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Total Gambling Hours Per Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Wager-Session Length&#39;</span><span class="p">,</span> <span class="s1">&#39;Mean Loss Per Month&#39;</span><span class="p">,</span> <span class="s1">&#39;Number Of Different Games Played&#39;</span><span class="p">,</span> <span class="s1">&#39;Total Number Of Games Played&#39;</span><span class="p">]</span>


<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">getmembers</span><span class="p">,</span> <span class="n">isfunction</span>
<span class="kn">import</span> <span class="nn">gamba</span> <span class="k">as</span> <span class="nn">gb</span>

<span class="c1"># make porting over a little easier</span>
<span class="n">check_measures_data</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">check_measure_data</span>
<span class="n">get_sessions</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">get_sessions</span>
<span class="n">aggregate_bets</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">measures</span><span class="o">.</span><span class="n">aggregate_bets</span>

<span class="n">player_bets</span> <span class="o">=</span> <span class="n">gb</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">example_bets</span><span class="p">()</span>

<span class="n">functions</span> <span class="o">=</span> <span class="n">getmembers</span><span class="p">(</span><span class="n">gb</span><span class="o">.</span><span class="n">measures</span><span class="p">,</span> <span class="n">isfunction</span><span class="p">)</span>

<span class="n">display</span><span class="p">(</span><span class="n">player_bets</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>player_id</th>
      <th>bet_size</th>
      <th>bet_time</th>
      <th>payout_size</th>
      <th>payout_time</th>
      <th>decimal_odds</th>
      <th>house_edge</th>
      <th>game_type</th>
      <th>provider</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2</td>
      <td>2020-12-15 15:03:00</td>
      <td>0.00</td>
      <td>2020-12-15 15:03:49</td>
      <td>2</td>
      <td>2</td>
      <td>coin flip</td>
      <td>coin provider</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1</td>
      <td>2</td>
      <td>2020-12-15 15:07:10</td>
      <td>0.00</td>
      <td>2020-12-15 15:07:28</td>
      <td>2</td>
      <td>2</td>
      <td>coin flip</td>
      <td>coin provider</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>3</td>
      <td>2020-12-15 15:08:31</td>
      <td>5.88</td>
      <td>2020-12-15 15:08:48</td>
      <td>2</td>
      <td>2</td>
      <td>coin flip</td>
      <td>coin provider</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>5</td>
      <td>2020-12-15 15:11:04</td>
      <td>9.80</td>
      <td>2020-12-15 15:11:25</td>
      <td>2</td>
      <td>2</td>
      <td>coin flip</td>
      <td>coin provider</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1</td>
      <td>5</td>
      <td>2020-12-15 15:14:27</td>
      <td>9.80</td>
      <td>2020-12-15 15:15:25</td>
      <td>2</td>
      <td>2</td>
      <td>coin flip</td>
      <td>coin provider</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="New-Behavioural-Measures">New Behavioural Measures<a class="anchor-link" href="#New-Behavioural-Measures"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LinearRegression</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">def</span> <span class="nf">aggregate_trajectory</span><span class="p">(</span><span class="n">player_bets</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;bet_size&#39;</span><span class="p">):</span>
    
    <span class="s2">&quot;Gradient of a linear regression fitted to the sequence of an aggregated behavioural measure. Aggregation level can be daily, weekly, or monthly.&quot;</span>
    
    <span class="n">check_measures_data</span><span class="p">(</span><span class="n">player_bets</span><span class="p">,</span> <span class="p">[</span><span class="n">variable</span><span class="p">])</span>
    
    <span class="n">bets</span> <span class="o">=</span> <span class="n">aggregate_bets</span><span class="p">(</span><span class="n">player_bets</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="n">aggregation</span><span class="p">)</span>
    <span class="n">aggregates</span> <span class="o">=</span> <span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="n">variable</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="k">for</span> <span class="n">df</span> <span class="ow">in</span> <span class="n">bets</span><span class="p">]</span>
    
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aggregates</span><span class="p">)))</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">aggregates</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">LinearRegression</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

    <span class="n">model_x</span> <span class="o">=</span> <span class="n">x</span>
    <span class="n">model_y</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">model</span><span class="o">.</span><span class="n">intercept_</span>

    <span class="k">if</span> <span class="n">plot</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">model_x</span><span class="p">,</span> <span class="n">model_y</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;r&quot;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">variable</span> <span class="o">+</span> <span class="s1">&#39; sum&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">model</span><span class="o">.</span><span class="n">coef_</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">total_wagered_trajectory</span><span class="p">(</span><span class="n">player_bets</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="s1">&#39;daily&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    
    <span class="k">return</span> <span class="n">aggregate_trajectory</span><span class="p">(</span><span class="n">player_bets</span><span class="p">,</span> <span class="n">aggregation</span><span class="o">=</span><span class="n">aggregation</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="n">plot</span><span class="p">,</span> <span class="n">variable</span><span class="o">=</span><span class="s1">&#39;bet_size&#39;</span><span class="p">)</span>

<span class="n">total_wagered_trajectory</span><span class="p">(</span><span class="n">player_bets</span><span class="p">,</span> <span class="n">aggregation</span> <span class="o">=</span> <span class="s1">&#39;monthly&#39;</span><span class="p">,</span> <span class="n">plot</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">total_paid</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># this is a poker-specific measure that is functionally identical to net_loss</span>
    <span class="k">pass</span>
<span class="k">def</span> <span class="nf">mean_rake_per_hour</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># mercantile game specific</span>
    <span class="k">pass</span>
<span class="k">def</span> <span class="nf">mean_simultaneous_tables</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># poker specific</span>
    <span class="k">pass</span>
<span class="k">def</span> <span class="nf">mean_rake_per_day</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># poker specific, casino games&#39; house edge doesn&#39;t function in the same way so is not comparable</span>
    <span class="k">pass</span>
<span class="k">def</span> <span class="nf">mean_volume_per_day</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># (identical to mean rake paid per day) time-specific derivative of rake paid</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">total_amount_won</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># this is functionally identical to -net_loss</span>
    <span class="k">pass</span>
<span class="k">def</span> <span class="nf">positive_total_amount_won</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># conditional duplicate of &#39;total_amount_won&#39;</span>
    <span class="k">pass</span>
<span class="k">def</span> <span class="nf">positive_amount_wagered</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># potentially function-identical variant</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">mean_wager_session_length</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># dragicevic variant, not identical to &#39;mean_session_length&#39; but difficult to generalise</span>
    <span class="k">pass</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">num_bets_trajectory</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">active_days_trajectory</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    <span class="k">pass</span>



<span class="k">def</span> <span class="nf">sawtooth_occurances</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># tricky business</span>
    <span class="k">pass</span>



<span class="k">def</span> <span class="nf">mean_gambling_hours_per_month</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">mean_loss_per_month</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">total_wagered_weekend_ratio</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">num_bets_weekend_ratio</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    <span class="k">pass</span>


<span class="k">def</span> <span class="nf">num_activities_played</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="k">def</span> <span class="nf">num_games_played</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span> <span class="c1"># duplicate of &#39;num_activities_played&#39;</span>
    <span class="k">pass</span>

<span class="k">def</span> <span class="nf">num_unique_games_played</span><span class="p">(</span><span class="n">player_bets</span><span class="p">):</span>
    
    
    <span class="k">return</span> <span class="nb">len</span><span class="p">(</span><span class="n">player_bets</span><span class="p">[</span><span class="s1">&#39;game_type&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="General-Improvements">General Improvements<a class="anchor-link" href="#General-Improvements"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># the neural networks used in the Philander 2014 replication need better documentation and parameterisation</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

</div>
 

